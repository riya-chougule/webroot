<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Webroot</title>
<link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link type="text/css" rel="stylesheet" href="localsite/css/base.css" id="/localsite/css/base.css" />
<link type="text/css" rel="stylesheet" href="team/css/common.css" />
<script type="text/javascript" src="localsite/js/localsite.js?showheader=true&showsearch=true"></script>
<script type="text/javascript" src="team/js/common.js"></script>
<script type="text/javascript" src="team/js/setup.js"></script>

<script>
// Create OS detection panel using shared function
autoCreateOSDetectionPanel('#commonSetupDiv');

loadMarkdown("README.md", "readmeDiv", "_parent", 1, function() {
    let currentPath = window.location.href;
    let myRepo = "PartnerTools"; // Default
    
    const githubPagesMatch = currentPath.match(/\/\/([^.]+)\.github\.io/);
    if (githubPagesMatch && githubPagesMatch[1]) {
        myRepo = githubPagesMatch[1];
    } else if (currentPath.includes("localhost") || currentPath.includes("model.earth")) {
        myRepo = "modelearth";
    }
    
    let linkString = "<a href='https://github.com/" + myRepo + "/webroot/' target='github_fork'>github.com/" + myRepo + "/webroot</a>";
    
    setTimeout(() => {
        const textInPage = document.getElementById('textInPage');
        if (textInPage) {
            const gitAccountField = document.getElementById("gitAccount");
            const myWebrootForkNameField = document.getElementById("myWebrootForkName");
            const gitAccountValue = gitAccountField ? gitAccountField.value : '';
            const myWebrootForkNameValue = myWebrootForkNameField ? myWebrootForkNameField.value : '';
            
            textInPage.innerHTML = textInPage.innerHTML.replace(/the webroot repo/g, linkString);
            
            const newGitAccountField = document.getElementById("gitAccount");
            const newMyWebrootForkNameField = document.getElementById("myWebrootForkName");
            if (newGitAccountField && gitAccountValue) newGitAccountField.value = gitAccountValue;
            if (newMyWebrootForkNameField && myWebrootForkNameValue) newMyWebrootForkNameField.value = myWebrootForkNameValue;
        }
    }, 100);
    
    setTimeout(() => {
        setupWebrootSetup('webrootSetup');
        setupGitAccountFields('textInPage');
        setupTradeFlowRepos('tradeFlowRepos');
        
        setTimeout(() => {
            updateForkReposCommands();
        }, 100);
    }, 200);
    
    const readmeDiv = document.getElementById('readmeDiv');
    if (readmeDiv) {
        let content = readmeDiv.innerHTML;
        const currentPort = window.location.port;
        const hasExplicitPort = currentPort !== '';
        const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        const currentPathname = window.location.pathname;
        const pathSegments = currentPathname.split('/').filter(segment => segment);
        let webrootFolder = '';
        if (pathSegments.length > 0 && isLocalhost && hasExplicitPort) webrootFolder = pathSegments[0];
        if (hasExplicitPort && currentPort !== '8887') {
            content = content.replace(/localhost:8887/g, `localhost:${currentPort}`);
            const portNotice = `<div style="background-color: #e7f3ff; border: 1px solid #b3d9ff; padding: 10px; margin-bottom: 15px; border-radius: 5px;"><strong>Your current port ${currentPort} has been used to replace 8887 in the display below.</strong></div>`;
            content = portNotice + content;
        }
        if (webrootFolder) {
            const portPattern = new RegExp(`localhost:${currentPort || '8887'}/`, 'g');
            content = content.replace(portPattern, `localhost:${currentPort || '8887'}/${webrootFolder}/`);
            if (webrootFolder !== "webroot") {
                setTimeout(() => {
                    const webrootForkNameField = document.getElementById("myWebrootForkName");
                    if (webrootForkNameField && !webrootForkNameField.value) {
                        webrootForkNameField.value = webrootFolder;
                        updateGitAccountFields();
                    }
                }, 100);
            }
        }
        readmeDiv.innerHTML = content;
    }
});
</script>

</head>

<body>
<div class="content contentpadding">
    <div class="card" id="textInPage">
      <div id="webrootSetup"></div>
    </div>
    <div id="commonSetupDiv"></div>
    <div id="nl-search" class="searchbar" style="margin-bottom: 1rem;">
        <input id="q" placeholder="Search projects in plain English…" />
        <label><input type="checkbox" id="fuzzy" checked /> Fuzzy</label>
        <input type="range" id="th" min="0" max="60" value="35" />
        <button id="ai-refine">Ask AI to refine</button>
    </div>
    <div id="search-results" style="margin-top: 1rem;"></div>
    <div id="readmeDiv" class="card"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const projects = [
    { name: "Project Alpha", description: "Optimize user onboarding flow" },
    { name: "Project Beta", description: "Implement AI recommendation system" },
    { name: "Project Gamma", description: "Cloud infrastructure upgrade" }
];


    const searchInput = document.getElementById("q");
    const fuzzyCheckbox = document.getElementById("fuzzy");
    const thresholdSlider = document.getElementById("th");
    const aiRefineBtn = document.getElementById("ai-refine");
    const searchResultsDiv = document.getElementById("search-results");

    const getFuse = () => new Fuse(projects, {
        keys: ['name', 'description'],
        threshold: thresholdSlider.value / 100,
        includeScore: true
    });

    const doSearch = () => {
        const query = searchInput.value.trim();
        if (!query) {
            searchResultsDiv.innerHTML = '';
            return;
        }

        const results = fuzzyCheckbox.checked 
            ? getFuse().search(query) 
            : projects.filter(p =>
                p.name.toLowerCase().includes(query.toLowerCase()) ||
                p.description.toLowerCase().includes(query.toLowerCase())
            );

        searchResultsDiv.innerHTML = results.map(r => {
            const item = r.item || r;
            return `<div class="card"><h3>${item.name}</h3><p>${item.description}</p></div>`;
        }).join('');
    };

    searchInput.addEventListener("input", doSearch);
    thresholdSlider.addEventListener("input", doSearch);
    fuzzyCheckbox.addEventListener("change", doSearch);

    // ✅ AI Refine functionality
    aiRefineBtn.addEventListener("click", () => {
        const query = searchInput.value.trim();
        if (!query) return;

        // Take top 2 matches as “AI refined”
        const refinedResults = projects
            .filter(p => p.name.toLowerCase().includes(query.toLowerCase()) ||
                         p.description.toLowerCase().includes(query.toLowerCase()))
            .slice(0, 2);

        searchResultsDiv.innerHTML = refinedResults.map(r =>
            `<div class="card"><h3>${r.name}</h3><p>${r.description} <em>(AI refined)</em></p></div>`
        ).join('');
    });
});
</script>

</body>
</html>
